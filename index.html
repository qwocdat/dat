<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>V√≤ng Quay Con Cac</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; }
    body {
      font-family: "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #0f1724, #071033);
      color: #fff;
      padding: 16px;
    }
    .card {
      width: 100%;
      max-width: 900px;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .left { flex:1; min-width: 280px; }
    .right { width: 300px; min-width: 240px; }
    h1 { font-size: 1.8rem; margin-bottom: 8px; }
    p.subtitle { color: #cbd5e1; margin-bottom: 20px; }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 1rem;
      margin-bottom: 12px;
    }
    button.btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: #ff6b6b;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button.btn:hover { background: #ff5252; }
    .wheel-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .pointer {
      width: 0; height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 40px solid #ff6b6b;
      margin-bottom: -20px;
    }
    .wheel {
      width: 360px; height: 360px;
      border-radius: 50%;
      border: 8px solid rgba(255,255,255,0.1);
      overflow: hidden;
      position: relative;
      transition: transform 6s cubic-bezier(0.25,1,0.5,1);
      transform-origin: center;
      background: conic-gradient(
        #ff6b6b 0deg 60deg,
        #ff6b6b 60deg 120deg,
        #ff6b6b 120deg 180deg,
        #ff6b6b 180deg 240deg,
        #ff6b6b 240deg 300deg,
        #5f27cd 300deg 360deg
      );
      /* T·∫•t c·∫£ ƒë·ªÅu ƒë·ªè (k·∫πo m√∫t) tr·ª´ 1 ph·∫ßn cu·ªëi l√† m√†u kh√°c (cho segment ‚ÄúBim bim‚Äù) */
    }
    .wheel-label {
      position: absolute;
      width: 50%;
      height: 50%;
      top: 0; left: 50%;
      transform-origin: 0% 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 16px;
      font-weight: bold;
      color: #111;
    }
    #spin-btn {
      margin-top: 16px;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 5px solid #fff;
      background: #ff6b6b;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
      outline: none;
    }
    #spin-btn:hover { background: #ff5252; }
    #spin-btn:disabled { background: #888; cursor: not-allowed; }
    .result-box {
      margin-top: 16px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 12px;
      min-height: 50px;
      text-align: center;
    }
    .winners {
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 12px;
      height: 520px;
      overflow-y: auto;
    }
    .winner-item {
      margin-bottom: 10px;
      background: rgba(0,0,0,0.2);
      padding: 10px;
      border-radius: 8px;
    }
    .winner-item span { color: #ffd166; font-weight: bold; }

    @media (max-width: 800px) {
      .card { flex-direction: column; }
      .right { width: 100%; }
      .wheel { width: 280px; height: 280px; }
      #spin-btn { width: 80px; height: 80px; }
    }
    @media (max-width: 480px) {
      .wheel { width: 220px; height: 220px; }
      #spin-btn { width: 60px; height: 60px; }
    }
    /* Snow effect */
    .snow { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    .snow div { position:absolute; color:#fff; font-size:12px; opacity:0.8; animation:fall linear infinite; }
    @keyframes fall {
      0% { transform: translateY(-10vh); }
      100% { transform: translateY(110vh); }
    }
  </style>
</head>
<body>
  <div class="snow" id="snow"></div>
  <div class="card">
    <div class="left">
      <h1>V√≤ng Quay May M·∫Øn</h1>
      <p class="subtitle">Nh·∫≠p t√™n ƒë·ªÉ quay Ok m·ªói ng∆∞·ªùi ch·ªâ quay 1 l·∫ßn OK.</p>

      <div id="name-section">
        <input id="name-input" type="text" placeholder="T√™n c·ªßa b·∫°n..." />
        <button id="btn-start" class="btn">B·∫Øt ƒë·∫ßu</button>
      </div>

      <div id="wheel-section" style="display:none;">
        <div class="wheel-wrap">
          <div class="pointer"></div>
          <div class="wheel" id="wheel"></div>
          <button id="spin-btn">QUAY</button>
          <div id="result" class="result-box">Nh·∫•n n√∫t ƒë·ªÉ quay</div>
        </div>
      </div>
    </div>

    <div class="right">
      <h2>L·ªãch S·ª≠ Tr√∫ng Th∆∞·ªüng</h2>
      <div id="winners" class="winners"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCpc4_AOG7UBiModzx2aDojLFnEXShsZ2Q",
      authDomain: "vongquay-dat.firebaseapp.com",
      databaseURL: "https://vongquay-dat-default-rtdb.firebaseio.com",
      projectId: "vongquay-dat",
      storageBucket: "vongquay-dat.firebasestorage.app",
      messagingSenderId: "520824815017",
      appId: "1:520824815017:web:c9ee216839877072f458b8",
      measurementId: "G-2E3H1CN1RX"
    };
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ========== Snow effect ==========
    const snowRoot = document.getElementById('snow');
    for (let i = 0; i < 40; i++) {
      const s = document.createElement('div');
      s.textContent = '‚ùÜ';
      s.style.left = Math.random() * 100 + 'vw';
      s.style.animationDuration = (5 + Math.random()*5) + 's';
      s.style.top = '-' + (10 + Math.random()*20) + 'vh';
      snowRoot.appendChild(s);
    }

    const prizes = ["K·∫πo m√∫t", "Bim bim"];
    // T·∫°o c·∫•u tr√∫c 2 ph·∫ßn th∆∞·ªüng ‚Äî th·ª±c t·∫ø v√≤ng quay s·∫Ω ph√¢n ph·ªëi theo tr·ªçng s·ªë 98 / 2

    const nameInput = document.getElementById('name-input');
    const btnStart = document.getElementById('btn-start');
    const nameSection = document.getElementById('name-section');
    const wheelSection = document.getElementById('wheel-section');
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spin-btn');
    const resultBox = document.getElementById('result');
    const winnersDom = document.getElementById('winners');

    let currentName = '';
    let spinning = false;

    // H√†m hi·ªÉn th·ªã l·ªãch s·ª≠ t·ª´ Firebase
    function loadWinners() {
      db.ref('winners').off();
      db.ref('winners').on('value', snapshot => {
        winnersDom.innerHTML = '';
        const data = snapshot.val();
        if (data) {
          // L·∫•y c√°c keys theo th·ª© t·ª± m·ªõi nh·∫•t tr∆∞·ªõc
          const arr = Object.entries(data).reverse();
          for (const [key, obj] of arr) {
            const item = document.createElement('div');
            item.className = 'winner-item';
            const timeStr = obj.time || '';
            item.innerHTML = `<span>${obj.name}</span> ƒë√£ tr√∫ng <strong>${obj.prize}</strong> ${timeStr}`;
            winnersDom.appendChild(item);
          }
        }
      });
    }
    loadWinners();

    // event b·∫Øt ƒë·∫ßu
    btnStart.onclick = () => {
      const name = nameInput.value.trim();
      if (!name) {
        alert('Vui l√≤ng nh·∫≠p t√™n!');
        return;
      }
      // Ki·ªÉm tra xem t√™n ƒë√£ quay ch∆∞a (trong DB)
      db.ref('players/' + name).get().then(snapshot => {
        if (snapshot.exists()) {
          alert('T√™n n√†y ƒë√£ quay r·ªìi!');
        } else {
          currentName = name;
          nameSection.style.display = 'none';
          wheelSection.style.display = 'block';
        }
      });
    };

    // X√¢y d·ª±ng nh√£n ph·∫ßn th∆∞·ªüng (m·∫∑c d√π v·∫Ω ph·∫ßn ‚Äúk·∫πo m√∫t‚Äù chi·∫øm ph·∫ßn l·ªõn, v√† ‚Äúbim bim‚Äù chi·∫øm ph·∫ßn nh·ªè)
    function renderLabels() {
      const count = 2;
      for (let i = 0; i < count; i++) {
        const lbl = document.createElement('div');
        lbl.className = 'wheel-label';
        lbl.style.transform = `rotate(${(360 / count) * i}deg) skewY(-30deg)`;
        lbl.textContent = prizes[i];
        wheel.appendChild(lbl);
      }
    }
    renderLabels();

    spinBtn.onclick = () => {
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      resultBox.textContent = 'ƒêang quay...';

      // L·∫•y ph·∫ßn th∆∞·ªüng theo tr·ªçng s·ªë: 98% k·∫πo m√∫t, 2% bim bim
      const r = Math.random() * 100;
      let idx = 0;
      if (r < 98) {
        idx = 0; // k·∫πo m√∫t
      } else {
        idx = 1; // bim bim
      }

      const segmentAngle = 360 / prizes.length;
      const offset = (idx * segmentAngle) + (segmentAngle / 2);
      const spins = 6 + Math.floor(Math.random() * 4);
      const rotateTo = (spins * 360) + (360 - offset);

      wheel.style.transform = `rotate(${rotateTo}deg)`;

      setTimeout(() => {
        const prizeWon = prizes[idx];
        const timeNow = new Date().toLocaleString();
        resultBox.textContent = `üéâ ${currentName} tr√∫ng: ${prizeWon}`;

        // Ghi d·ªØ li·ªáu v√†o Firebase
        const newRef = db.ref('winners').push();
        newRef.set({
          name: currentName,
          prize: prizeWon,
          time: timeNow
        });

        // ƒê√°nh d·∫•u ng∆∞·ªùi n√†y ƒë√£ quay
        db.ref('players/' + currentName).set(true);

        // L√†m m·ªõi danh s√°ch hi·ªÉn th·ªã
        loadWinners();

        spinning = false;
        spinBtn.textContent = 'ƒê√£ quay';
      }, 6000);
    };
  </script>
</body>
</html>
