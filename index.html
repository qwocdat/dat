<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>V√≤ng Quay May M·∫Øn ‚Äî Dat</title>
<style>
  /* --- Responsive + styles t·ªëi ∆∞u cho mobile & desktop --- */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,#0f1724 0%,#071033 100%);
    color:#fff;padding:16px;
  }
  .card{
    width:100%;max-width:980px;background:rgba(255,255,255,0.04);
    border-radius:16px;padding:18px;backdrop-filter:blur(8px);
    box-shadow:0 8px 30px rgba(2,6,23,0.6);
    display:flex;gap:20px;flex-wrap:wrap;
  }
  .left{flex:1;min-width:280px}
  .right{width:320px;min-width:230px}
  h1{font-size:1.6rem;margin-bottom:6px}
  p.sub{color:#cbd5e1;margin-bottom:12px}

  input[type="text"]{
    width:100%;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);
    color:#fff;font-size:1rem;margin-bottom:10px;
  }
  button.primary{
    background:#ff6b6b;border:none;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;
    cursor:pointer;
  }
  .wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .wheel{
    width:360px;height:360px;border-radius:50%;border:8px solid rgba(255,255,255,0.08);
    overflow:hidden;position:relative;transition:transform 6s cubic-bezier(.25,1,.5,1);
    will-change:transform; background:conic-gradient(#ff6b6b 0 60deg,#feca57 60deg 120deg,#48dbfb 120deg 180deg,#1dd1a1 180deg 240deg,#ff9ff3 240deg 300deg,#5f27cd 300deg 360deg);
  }
  .pointer{position:relative;align-self:center;margin-bottom:-24px}
  .pointer:after{content:'';display:block;width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-top:36px solid #ff6b6b}
  #spin-btn{width:92px;height:92px;border-radius:50%;border:5px solid #fff;background:#ff6b6b;color:#fff;font-weight:800;cursor:pointer}
  .result{margin-top:12px;background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;min-height:56px}
  .winners{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;height:520px;overflow:auto}
  .winner-item{padding:10px;background:rgba(0,0,0,0.15);border-radius:8px;margin-bottom:8px}
  .winner-item span{color:#ffd166;font-weight:700}

  /* responsive */
  @media (max-width:880px){
    .card{flex-direction:column}
    .right{width:100%}
    .wheel{width:300px;height:300px}
  }
  @media (max-width:420px){
    .wheel{width:250px;height:250px}
    #spin-btn{width:76px;height:76px}
  }
  /* snow */
  .snow{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:5}
  .snow div{position:absolute;color:#fff;opacity:.9;font-size:12px}
</style>
</head>
<body>
  <div class="snow" id="snow"></div>

  <main class="card" role="main">
    <section class="left">
      <h1>V√≤ng Quay May M·∫Øn</h1>
      <p class="sub">Nh·∫≠p t√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu ‚Äî m·ªói t√™n ch·ªâ ƒë∆∞·ª£c quay 1 l·∫ßn. Responsive cho mobile & desktop.</p>

      <div id="name-entry">
        <input id="name-input" type="text" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." />
        <button id="start-btn" class="primary">B·∫Øt ƒë·∫ßu</button>
      </div>

      <div id="wheel-section" style="display:none;margin-top:14px">
        <div class="wheel-wrap">
          <div class="pointer" aria-hidden="true"></div>
          <div id="wheel" class="wheel" aria-hidden="true"></div>
          <button id="spin-btn" title="Quay">QUAY</button>
          <div id="result" class="result">Nh·∫•n QUAY ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>
        </div>
      </div>
    </section>

    <aside class="right">
      <h2 style="margin-bottom:10px">L·ªãch S·ª≠ Tr√∫ng Th∆∞·ªüng</h2>
      <div id="winners" class="winners" aria-live="polite"></div>
    </aside>
  </main>

<script>
/* ========== T·∫°o tuy·∫øt r∆°i nh·∫π ========== */
const snowRoot = document.getElementById('snow');
for(let i=0;i<40;i++){
  const s = document.createElement('div');
  s.textContent = '‚ùÜ';
  s.style.left = Math.random()*100 + 'vw';
  s.style.top = (-10 - Math.random()*20) + 'vh';
  s.style.fontSize = (8 + Math.random()*12) + 'px';
  s.style.opacity = 0.6 + Math.random()*0.4;
  s.style.transition = 'transform linear';
  s.style.animation = `fall ${8 + Math.random()*10}s linear ${Math.random()*5}s infinite`;
  snowRoot.appendChild(s);
}
const styleSheet = document.createElement('style');
styleSheet.textContent = '@keyframes fall { 0%{transform:translateY(-10vh)} 100%{transform:translateY(110vh)} }';
document.head.appendChild(styleSheet);

/* ========== Data & DOM refs ========== */
const PRIZES = ["K·∫πo m√∫t","Bimbim","50k","Balo bim","10k","100k"];
const weights = [40,20,10,10,10,10]; // t·ªâ l·ªá
const wheel = document.getElementById('wheel');
const startBtn = document.getElementById('start-btn');
const nameInput = document.getElementById('name-input');
const wheelSection = document.getElementById('wheel-section');
const spinBtn = document.getElementById('spin-btn');
const resultBox = document.getElementById('result');
const winnersDom = document.getElementById('winners');

let isSpinning=false;
let currentPlayer='';

/* T·∫°o v√≤ng b·∫±ng c√°c segment (v·∫Ω b·∫±ng conic-gradient ƒë√£ c√≥, th√™m labels b·∫±ng DOM) */
function renderLabels(){
  const count = PRIZES.length;
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.width='50%';
    el.style.height='50%';
    el.style.top='0';el.style.left='50%';
    el.style.transformOrigin='0% 100%';
    el.style.transform = `rotate(${(360/count)*i}deg) skewY(-30deg)`;
    el.style.display='flex';el.style.alignItems='flex-start';el.style.justifyContent='center';
    el.style.paddingTop='22px';el.style.fontWeight='700';el.style.fontSize='0.9rem';
    el.style.color = (i===5?'#fff':'#111');
    el.textContent = PRIZES[i];
    wheel.appendChild(el);
  }
}
renderLabels();

/* Load winners from localStorage */
function loadWinners(){
  const html = localStorage.getItem('winners_html');
  if(html) winnersDom.innerHTML = html;
}
loadWinners();

/* Start button */
startBtn.addEventListener('click', ()=>{
  const name = nameInput.value.trim();
  if(!name){ alert('Vui l√≤ng nh·∫≠p t√™n!'); return; }
  if(localStorage.getItem('player_'+name)){ alert('T√™n n√†y ƒë√£ quay r·ªìi!'); return; }
  currentPlayer = name;
  document.getElementById('name-entry').style.display='none';
  wheelSection.style.display='block';
});

/* Spin logic */
spinBtn.addEventListener('click', ()=>{
  if(isSpinning) return;
  isSpinning=true;
  spinBtn.disabled=true;
  resultBox.textContent = 'ƒêang quay...';

  // random theo tr·ªçng s·ªë
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*total, cum=0, idx=0;
  for(let i=0;i<weights.length;i++){ cum += weights[i]; if(r < cum){ idx = i; break; } }

  const segmentAngle = 360/PRIZES.length;
  const targetOffset = (idx*segmentAngle) + (Math.random()*(segmentAngle-8)+4);
  const spins = 6 + Math.floor(Math.random()*4);
  const rotateTo = (spins*360) + (360 - targetOffset);

  // apply rotation
  wheel.style.transform = `rotate(${rotateTo}deg)`;

  // after animation
  setTimeout(()=>{
    const prize = PRIZES[idx] || PRIZES[0];
    resultBox.textContent = `üéâ ${currentPlayer} tr√∫ng: ${prize}`;
    const item = document.createElement('div');
    item.className = 'winner-item';
    item.innerHTML = `<span>${currentPlayer}</span> ƒë√£ tr√∫ng <strong>${prize}</strong>`;
    winnersDom.prepend(item);
    // save
    localStorage.setItem('player_'+currentPlayer, prize);
    localStorage.setItem('winners_html', winnersDom.innerHTML);
    isSpinning=false;
    spinBtn.disabled = true;
    spinBtn.textContent = 'ƒê√£ quay';
  }, 6000);
});

/* Accessibility: restore if winners present but user not started */
if(localStorage.getItem('winners_html')){ /* keep wheel hidden until user start */ }

</script>
</body>
</html>
